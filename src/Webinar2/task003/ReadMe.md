Обработайте возможные исключительные ситуации. "Битые" значения в исходном массиве считайте нулями. Можно внести в код правки, которые считаете необходимыми.